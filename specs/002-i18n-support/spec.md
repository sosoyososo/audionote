# Feature Specification: iOS 应用多语言支持

**Feature Branch**: `002-i18n-support`
**Created**: 2026-01-19
**Status**: Draft
**Input**: User description: "为 AudioNote iOS 应用添加多语言支持"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 切换应用界面语言 (Priority: P1)

作为用户，我希望能够在应用内切换界面显示的语言，这样我可以使用我熟悉的语言来操作应用。

**Why this priority**: 这是核心功能，没有语言切换能力就无法满足多语言用户群体的基本需求。

**Independent Test**: 可以通过打开应用、打开语言选择器、选择不同语言、验证界面文本立即更新来完整测试。

**Acceptance Scenarios**:

1. **Given** 用户打开应用，**When** 用户打开语言选择器并选择"English"，**Then** 所有界面文本立即变为英文，无需重启应用
2. **Given** 用户已选择英文界面，**When** 用户选择"中文简体"，**Then** 所有界面文本立即变为中文
3. **Given** 用户选择"跟随系统"，**When** 设备系统语言为中文，**Then** 界面显示中文；**When** 设备系统语言为英文，**Then** 界面显示英文
4. **Given** 用户设备系统语言为非中英文（如日语），**When** 用户选择"跟随系统"，**Then** 界面默认显示英文

---

### User Story 2 - 访问语言设置入口 (Priority: P1)

作为用户，我希望能够方便地找到语言切换的入口，这样我可以快速更改界面语言。

**Why this priority**: 如果用户找不到语言切换的入口，多语言功能就无法被使用，必须确保入口可见且易于访问。

**Independent Test**: 可以在应用主界面找到语言切换入口并点击打开语言选择器来测试。

**Acceptance Scenarios**:

1. **Given** 用户在主界面，**When** 用户点击录音按钮上方的设置图标或语言切换按钮，**Then** 弹出语言选择页面
2. **Given** 用户在录音页面，**When** 用户点击工具栏上的语言切换按钮，**Then** 弹出语言选择页面
3. **Given** 语言选择页面已打开，**When** 用户点击空白区域或取消按钮，**Then** 语言选择页面关闭

---

### User Story 3 - 语言设置持久化 (Priority: P2)

作为用户，我希望我的语言设置在下次打开应用时仍然保持，这样我不需要每次都重新设置。

**Why this priority**: 提升用户体验，避免用户重复设置，是多语言支持的标准期望行为。

**Independent Test**: 设置语言后关闭应用并重新打开，验证语言设置是否保持。

**Acceptance Scenarios**:

1. **Given** 用户已设置界面语言为英文，**When** 用户关闭应用后重新打开，**Then** 界面仍然显示英文
2. **Given** 用户已设置界面语言为中文，**When** 用户关闭应用后重新打开，**Then** 界面仍然显示中文

---

### User Story 4 - 所有界面文本本地化 (Priority: P1)

作为使用不同语言的用户，我希望应用的所有文字都能用我选择的语言显示，这样我可以完全理解应用的内容。

**Why this priority**: 如果有任何文本仍然使用硬编码的原始语言，多语言支持就不完整，用户体验会很差。

**Independent Test**: 遍历应用的所有页面，检查每个文本是否都已正确本地化为所选语言。

**Acceptance Scenarios**:

1. **Given** 用户选择英文界面，**When** 用户浏览录音页面、历史记录页面、详情页面，**Then** 所有文本显示为英文
2. **Given** 用户选择中文界面，**When** 用户浏览录音页面、历史记录页面、详情页面，**Then** 所有文本显示为中文

---

### Edge Cases

- 用户首次安装应用且系统语言为非中英文时，应用应默认显示英文界面
- 用户在录音过程中切换语言，正在录音的界面应立即更新为新语言
- 语言设置与语音识别的识别语言是两个独立设置，互不影响
- 网络不可用时，语言切换功能仍然可用（本地化资源在本地）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 提供三种语言选项：跟随系统、中文简体、英文
- **FR-002**: 系统 MUST 在用户选择语言后立即更新所有界面文本，无需重启应用
- **FR-003**: 系统 MUST 在语言选择时显示简洁的选择界面，包含当前选项和可用选项
- **FR-004**: 系统 MUST 在用户选择"跟随系统"时，根据设备首选语言显示界面
- **FR-005**: 系统 MUST 当设备首选语言既非中文也非英文时，默认使用英文界面
- **FR-006**: 系统 MUST 将用户选择的语言设置持久化存储，应用重启后保持不变
- **FR-007**: 系统 MUST 将所有用户可见的文本字符串提取到 Localizable.strings 文件管理
- **FR-008**: 系统 MUST 提供语言切换的入口按钮，位置在录音页面的工具栏或设置区域
- **FR-009**: 系统 MUST 语言切换时不在界面显示 toast 或其他提示信息
- **FR-010**: 系统 MUST 语音识别的识别语言设置独立于界面语言设置

### Key Entities

- **AppLanguage**: 表示应用界面语言的枚举，包含 system（跟随系统）、chinese（中文）、english（英文）三个值
- **LanguageManager**: 语言管理服务，负责存储当前语言设置、提供语言切换方法、广播语言变更通知
- **LocalizedStrings**: 本地化字符串资源，包含所有 UI 文本的中英文映射

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在 3 次点击内完成语言切换操作
- **SC-002**: 语言切换后界面文本在 500ms 内完成更新，用户无感知延迟
- **SC-003**: 100% 的用户可见文本（按钮、标签、提示信息等）都已正确本地化
- **SC-004**: 语言设置在应用重启后保持，测试通过率 100%
- **SC-005**: 当设备语言为非中英文时，界面显示英文，测试通过率 100%
- **SC-006**: 语音识别语言与界面语言独立设置，互不影响，测试通过率 100%
